"use strict";const e=require("../../common/vendor.js"),r={data:()=>({currentTab:0,userForm:{username:"",password:"",phone:"",role:"user",department:""},errors:{username:"",password:"",phone:""},userList:[],searchKey:"",departmentOptions:[{label:"财务组",value:"财务组"},{label:"硬件组",value:"硬件组"},{label:"光学组",value:"光学组"},{label:"软件组",value:"软件组"}]}),computed:{filteredUserList(){if(!this.searchKey)return this.userList;const e=this.searchKey.toLowerCase();return this.userList.filter((r=>r.username.toLowerCase().includes(e)||r.phone.includes(e)))}},methods:{switchTab(e){this.currentTab=e,1===e&&this.getList()},handleSwiperChange(e){this.currentTab=e.detail.current,1===this.currentTab&&this.getList()},validateForm(){let e=!0;return this.errors={username:"",password:"",phone:""},this.userForm.username||(this.errors.username="请输入用户名",e=!1),this.userForm.password||(this.errors.password="请输入密码",e=!1),this.userForm.phone?/^1[3-9]\d{9}$/.test(this.userForm.phone)||(this.errors.phone="请输入正确的账号",e=!1):(this.errors.phone="请输入账号",e=!1),e},handleRoleChange(e){this.userForm.role=parseInt(e.detail.value)},handleDepartmentChange(e){this.userForm.department=e.detail.value},async submitForm(){if(this.validateForm()){e.index.showLoading({title:"提交中"});const r=await this.$api.user_add(this.userForm);console.log(r),e.index.hideLoading(),this.userForm={username:"",password:"",phone:"",role:"user",department:""},this.switchTab(1)}},handleSearch(){},handleEdit(r){e.index.showModal({title:"编辑用户",content:"确定要编辑该用户吗？",success:r=>{r.confirm&&e.index.showToast({title:"编辑功能开发中",icon:"none"})}})},handleDelete(r){e.index.showModal({title:"删除用户",content:"确定要删除该用户吗？",success:async e=>{if(e.confirm){const e=this.userList.findIndex((e=>e._id===r._id));if(console.log(e,this.userList),e>-1){0===(await this.$api.user_delete({id:this.userList[e]._id})).code&&this.getList()}}}})},async getList(){const e=await this.$api.user_list();this.userList=e.data.data},showDepartmentPicker(){e.index.showActionSheet({itemList:this.departmentOptions.map((e=>e.label)),success:e=>{this.userForm.department=this.departmentOptions[e.tapIndex].value},fail:e=>{console.log(e.errMsg)}})}}};const s=e._export_sfc(r,[["render",function(r,s,t,o,a,i){return e.e({a:0===a.currentTab?1:"",b:e.o((e=>i.switchTab(0))),c:1===a.currentTab?1:"",d:e.o((e=>i.switchTab(1))),e:a.errors.username?1:"",f:a.userForm.username,g:e.o((e=>a.userForm.username=e.detail.value)),h:a.errors.username},a.errors.username?{i:e.t(a.errors.username)}:{},{j:a.errors.password?1:"",k:a.userForm.password,l:e.o((e=>a.userForm.password=e.detail.value)),m:a.errors.password},a.errors.password?{n:e.t(a.errors.password)}:{},{o:a.errors.phone?1:"",p:a.userForm.phone,q:e.o((e=>a.userForm.phone=e.detail.value)),r:a.errors.phone},a.errors.phone?{s:e.t(a.errors.phone)}:{},{t:e.t(a.userForm.department||"请选择部门"),v:e.o(((...e)=>i.showDepartmentPicker&&i.showDepartmentPicker(...e))),w:"user"===a.userForm.role,x:"admin"===a.userForm.role,y:e.o(((...e)=>i.handleRoleChange&&i.handleRoleChange(...e))),z:e.o(((...e)=>i.submitForm&&i.submitForm(...e))),A:e.o([e=>a.searchKey=e.detail.value,(...e)=>i.handleSearch&&i.handleSearch(...e)]),B:a.searchKey,C:e.f(i.filteredUserList,((r,s,t)=>({a:e.t(r.username),b:e.t(r.phone),c:e.t("user"===r.role?"普通用户":"管理员"),d:e.o((e=>i.handleEdit(r)),s),e:e.o((e=>i.handleDelete(r)),s),f:s}))),D:a.currentTab,E:e.o(((...e)=>i.handleSwiperChange&&i.handleSwiperChange(...e)))})}],["__scopeId","data-v-2d8e92fc"]]);wx.createPage(s);
