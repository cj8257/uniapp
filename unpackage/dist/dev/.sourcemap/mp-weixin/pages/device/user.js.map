{"version":3,"file":"user.js","sources":["pages/device/user.vue","../../Downloads/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZGV2aWNlL3VzZXIudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 顶部标签页 -->\n    <view class=\"tabs\">\n      <view \n        class=\"tab-item\" \n        :class=\"{'active': currentTab === 0}\"\n        @click=\"switchTab(0)\"\n      >\n        <text>用户注册</text>\n      </view>\n      <view \n        class=\"tab-item\" \n        :class=\"{'active': currentTab === 1}\"\n        @click=\"switchTab(1)\"\n      >\n        <text>用户列表</text>\n      </view>\n    </view>\n    \n    <!-- 滑动区域 -->\n    <swiper \n      class=\"swiper\" \n      :current=\"currentTab\"\n      @change=\"handleSwiperChange\"\n    >\n      <!-- 用户注册页面 -->\n      <swiper-item>\n        <form @submit=\"submitForm\">\n          <view class=\"form-item\">\n            <text class=\"label\">用户名</text>\n            <input \n              class=\"input\" \n              v-model=\"userForm.username\" \n              placeholder=\"请输入用户名\"\n              :class=\"{'error': errors.username}\"\n            />\n            <text class=\"error-text\" v-if=\"errors.username\">{{errors.username}}</text>\n          </view>\n          \n          <view class=\"form-item\">\n            <text class=\"label\">密码</text>\n            <input \n              class=\"input\" \n              v-model=\"userForm.password\" \n              type=\"password\" \n              placeholder=\"请输入密码\"\n              :class=\"{'error': errors.password}\"\n            />\n            <text class=\"error-text\" v-if=\"errors.password\">{{errors.password}}</text>\n          </view>\n          \n          <view class=\"form-item\">\n            <text class=\"label\">帐号</text>\n            <input \n              class=\"input\" \n              v-model=\"userForm.phone\" \n              placeholder=\"请输入帐号\"\n              :class=\"{'error': errors.phone}\"\n            />\n            <text class=\"error-text\" v-if=\"errors.phone\">{{errors.phone}}</text>\n          </view>\n          <view class=\"form-item\">\n            <text class=\"label\">部门</text>\n            <view class=\"picker-trigger\" @click=\"showDepartmentPicker\">\n              <text class=\"picker-value\">{{userForm.department || '请选择部门'}}</text>\n              <text class=\"picker-arrow\">></text>\n            </view>\n          </view>\n          <view class=\"form-item\">\n            <text class=\"label\">角色</text>\n            <radio-group class=\"radio-group\" @change=\"handleRoleChange\">\n              <label class=\"radio-label\">\n                <radio value=\"user\" :checked=\"userForm.role === 'user'\" color=\"#007AFF\" />\n                <text>普通用户</text>\n              </label>\n              <label class=\"radio-label\">\n                <radio value=\"admin\" :checked=\"userForm.role === 'admin'    \" color=\"#007AFF\" />\n                <text>管理员</text>\n              </label>\n            </radio-group>\n          </view>\n          \n          <view class=\"btn-submit\">\n            <button class=\"submit-btn\" form-type=\"submit\" type=\"primary\">提交</button>\n          </view>\n        </form>\n      </swiper-item>\n      \n      <!-- 用户列表页面 -->\n      <swiper-item>\n        <view class=\"user-list\">\n          <view class=\"search-box\">\n            <input \n              class=\"search-input\" \n              v-model=\"searchKey\" \n              placeholder=\"搜索用户名或账号\"\n              @input=\"handleSearch\"\n            />\n          </view>\n          \n          <view class=\"list-content\">\n            <view \n              class=\"user-item\" \n              v-for=\"(item, index) in filteredUserList\" \n              :key=\"index\"\n            >\n              <view class=\"user-info\">\n                <text class=\"username\">{{item.username}}</text>\n                <text class=\"phone\">{{item.phone}}</text>\n                <text class=\"role\">{{item.role === 'user' ? '普通用户' : '管理员'}}</text>\n              </view>\n              <view class=\"actions\">\n                <text class=\"action-btn edit\" @click=\"handleEdit(item)\">编辑</text>\n                <text class=\"action-btn delete\" @click=\"handleDelete(item)\">删除</text>\n              </view>\n            </view>\n          </view>\n        </view>\n      </swiper-item>\n    </swiper>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      currentTab: 0,\n      userForm: {\n        username: '',\n        password: '',\n        phone: '',\n        role: 'user',\n        department: ''\n      },\n      errors: {\n        username: '',\n        password: '',\n        phone: ''\n      },\n      // 模拟用户数据\n      userList: [\n      ],\n      searchKey: '',\n      departmentOptions: [\n        { label: '财务组', value: '财务组' },\n        { label: '硬件组', value: '硬件组' },\n        { label: '光学组', value: '光学组' },\n        { label: '软件组', value: '软件组' }\n      ]\n    }\n  },\n  computed: {\n    filteredUserList() {\n      if (!this.searchKey) return this.userList\n      const key = this.searchKey.toLowerCase()\n      return this.userList.filter(item => \n        item.username.toLowerCase().includes(key) || \n        item.phone.includes(key)\n      )\n    }\n  },\n  methods: {\n    switchTab(index) {\n      // 切换到用户列表页面\n      this.currentTab = index\n      // 获取用户列表\n      if (index === 1) {\n        this.getList()\n      }\n    },\n    handleSwiperChange(e) {\n      this.currentTab = e.detail.current\n      // 获取用户列表\n      if (this.currentTab === 1) {\n        this.getList()\n      }\n    },\n    validateForm() {\n      let isValid = true\n      this.errors = {\n        username: '',\n        password: '',\n        phone: ''\n      }\n      \n      if (!this.userForm.username) {\n        this.errors.username = '请输入用户名'\n        isValid = false\n      }\n      \n      if (!this.userForm.password) {\n        this.errors.password = '请输入密码'\n        isValid = false\n      }\n      \n      if (!this.userForm.phone) {\n        this.errors.phone = '请输入账号'\n        isValid = false\n      } else if (!/^1[3-9]\\d{9}$/.test(this.userForm.phone)) {\n        this.errors.phone = '请输入正确的账号'\n        isValid = false\n      }\n      \n      return isValid\n    },\n    handleRoleChange(e) {\n      this.userForm.role = parseInt(e.detail.value)\n    },\n    handleDepartmentChange(e) {\n      this.userForm.department = e.detail.value\n    },\n   async submitForm() {\n      if (this.validateForm()) {\n        uni.showLoading({\n          title: '提交中'\n        })\n        // 模拟API调用\n         const res = await this.$api.user_add(this.userForm)\n         console.log(res)\n          uni.hideLoading()\n          // 重置表单\n          this.userForm = {\n            username: '',\n            password: '',\n            phone: '',\n            role: 'user',\n            department: ''\n          }\n          // 切换到用户列表页面\n          this.switchTab(1)\n\n      }\n    },\n    handleSearch() {\n      // 搜索功能已通过计算属性实现\n    },\n    handleEdit(user) {\n      uni.showModal({\n        title: '编辑用户',\n        content: '确定要编辑该用户吗？',\n        success: (res) => {\n          if (res.confirm) {\n            // 跳转到编辑页面或显示编辑弹窗\n            uni.showToast({\n              title: '编辑功能开发中',\n              icon: 'none'\n            })\n          }\n        }\n      })\n    },\n    handleDelete(user) {\n      uni.showModal({\n        title: '删除用户',\n        content: '确定要删除该用户吗？',\n        success: async (res) => {\n          if (res.confirm) {\n            const index = this.userList.findIndex(item => item._id === user._id)\n            console.log(index, this.userList);\n            if (index > -1) {\n              const res = await this.$api.user_delete({id: this.userList[index]._id})\n              if (res.code === 0) {\n                this.getList()\n              }\n            }\n          }\n        }\n      })\n    },\n    async getList() {\n      const res = await this.$api.user_list()\n      this.userList = res.data.data\n    },\n    showDepartmentPicker() {\n      uni.showActionSheet({\n        itemList: this.departmentOptions.map(item => item.label),\n        success: (res) => {\n          this.userForm.department = this.departmentOptions[res.tapIndex].value;\n        },\n        fail: (res) => {\n          console.log(res.errMsg);\n        }\n      });\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n}\n\n.tabs {\n  display: flex;\n  background-color: #fff;\n  padding: 20rpx 0;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: 100;\n  \n  .tab-item {\n    flex: 1;\n    text-align: center;\n    font-size: 28rpx;\n    color: #666;\n    position: relative;\n    \n    &.active {\n      color: #007AFF;\n      font-weight: bold;\n      \n      &::after {\n        content: '';\n        position: absolute;\n        bottom: -10rpx;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 40rpx;\n        height: 4rpx;\n        background-color: #007AFF;\n        border-radius: 2rpx;\n      }\n    }\n  }\n}\n\n.swiper {\n  height: calc(100vh - 88rpx);\n  margin-top: 88rpx;\n}\n\n// 用户注册表单样式\n.form-item {\n  background-color: #fff;\n  padding: 20rpx;\n  margin-bottom: 20rpx;\n  border-radius: 8rpx;\n  \n  .label {\n    display: block;\n    font-size: 28rpx;\n    color: #333;\n    margin-bottom: 16rpx;\n  }\n  \n  .input {\n    width: 100%;\n    height: 80rpx;\n    font-size: 28rpx;\n    padding: 0 20rpx;\n    border: 1px solid #ddd;\n    border-radius: 4rpx;\n    \n    &.error {\n      border-color: #ff4d4f;\n    }\n  }\n  \n  .error-text {\n    font-size: 24rpx;\n    color: #ff4d4f;\n    margin-top: 8rpx;\n    display: block;\n  }\n}\n\n.radio-group {\n  display: flex;\n  flex-direction: column;\n  gap: 20rpx;\n  \n  .radio-label {\n    display: flex;\n    align-items: center;\n    font-size: 28rpx;\n    color: #333;\n    \n    text {\n      margin-left: 10rpx;\n    }\n  }\n}\n\n.btn-submit {\n  margin-top: 60rpx;\n  padding: 0 20rpx;\n  \n  .submit-btn {\n    width: 100%;\n    height: 88rpx;\n    line-height: 88rpx;\n    background-color: #007AFF;\n    color: #fff;\n    font-size: 32rpx;\n    border-radius: 44rpx;\n  }\n}\n\n// 用户列表样式\n.user-list {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  \n  .search-box {\n    padding: 20rpx;\n    background-color: #fff;\n    \n    .search-input {\n      width: 100%;\n      height: 72rpx;\n      background-color: #f5f5f5;\n      border-radius: 36rpx;\n      padding: 0 30rpx;\n      font-size: 28rpx;\n    }\n  }\n  \n  .list-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 20rpx;\n    \n    .user-item {\n      background-color: #fff;\n      border-radius: 8rpx;\n      padding: 20rpx;\n      margin-bottom: 20rpx;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      \n      .user-info {\n        flex: 1;\n        \n        .username {\n          font-size: 32rpx;\n          color: #333;\n          font-weight: bold;\n          display: block;\n        }\n        \n        .phone {\n          font-size: 28rpx;\n          color: #666;\n          margin-top: 8rpx;\n          display: block;\n        }\n        \n        .role {\n          font-size: 24rpx;\n          color: #007AFF;\n          margin-top: 8rpx;\n          display: block;\n        }\n      }\n      \n      .actions {\n        display: flex;\n        gap: 20rpx;\n        \n        .action-btn {\n          font-size: 28rpx;\n          padding: 10rpx 20rpx;\n          border-radius: 4rpx;\n          \n          &.edit {\n            color: #007AFF;\n            background-color: rgba(0, 122, 255, 0.1);\n          }\n          \n          &.delete {\n            color: #ff4d4f;\n            background-color: rgba(255, 77, 79, 0.1);\n          }\n        }\n      }\n    }\n  }\n}\n\n.picker-trigger {\n  width: 100%;\n  height: 80rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 20rpx;\n  border: 1px solid #ddd;\n  border-radius: 4rpx;\n  background-color: #fff;\n  \n  .picker-value {\n    font-size: 28rpx;\n    color: #333;\n    \n    &:empty::before {\n      content: '请选择部门';\n      color: #999;\n    }\n  }\n  \n  .picker-arrow {\n    color: #999;\n    font-size: 28rpx;\n    transform: rotate(90deg);\n  }\n}\n</style>\n","import MiniProgramPage from 'C:/Users/admin/Desktop/办公管理/pages/device/user.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","res"],"mappings":"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"}